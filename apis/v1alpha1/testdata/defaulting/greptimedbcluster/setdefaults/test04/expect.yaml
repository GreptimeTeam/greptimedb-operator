apiVersion: greptime.io/v1alpha1
kind: GreptimeDBCluster
metadata:
  name: test04
  namespace: default
spec:
  version: latest
  initializer:
    image: greptime/greptimedb-initializer:latest
  httpPort: 5000
  rpcPort: 4001
  mysqlPort: 4002
  postgreSQLPort: 4003
  logging:
    format: text
    level: info
    logsDir: /data/greptimedb/logs
    onlyLogToStdout: false
    persistentWithData: false
  base:
    main:
      image: greptime/greptimedb:latest
      livenessProbe:
        httpGet:
          path: /health
          port: 4000
        periodSeconds: 5
        failureThreshold: 10
      readinessProbe:
        httpGet:
          path: /health
          port: 4000
        periodSeconds: 5
        failureThreshold: 10
      startupProbe:
        httpGet:
          path: /health
          port: 4000
        periodSeconds: 5
        failureThreshold: 60
  frontendGroups:
  - name: read
    replicas: 1
    httpPort: 6000
    mysqlPort: 6002
    postgreSQLPort: 6003
    rpcPort: 6001
    service:
      type: ClusterIP
    slowQuery:
      enabled: true
      recordType: system_table
      sampleRatio: "1.0"
      threshold: 30s
      ttl: 90d
    logging: {}
    tracing: {}
    template: {}
    rollingUpdate:
      maxSurge: 25%
      maxUnavailable: 25%
  - name: write
    replicas: 2
    httpPort: 7000
    mysqlPort: 7002
    postgreSQLPort: 7003
    rpcPort: 7001
    logging: {}
    tracing: {}
    template: {}
    service:
      type: ClusterIP
    slowQuery:
      enabled: true
      recordType: system_table
      sampleRatio: "1.0"
      threshold: 30s
      ttl: 90d
    rollingUpdate:
      maxSurge: 50%
      maxUnavailable: 50%
  meta:
    backendStorage:
      etcd:
        endpoints:
          - etcd.etcd-cluster.svc.cluster.local:2379
    enableRegionFailover: false
    httpPort: 4000
    rpcPort: 3002
    replicas: 1
    logging: {}
    tracing: {}
    template: {}
    rollingUpdate:
      maxSurge: 25%
      maxUnavailable: 25%
  datanode:
    httpPort: 4000
    rpcPort: 4001
    replicas: 3
    storage:
      dataHome: /data/greptimedb
      fs:
        name: datanode
        mountPath: /data/greptimedb
        storageRetainPolicy: Retain
        storageSize: 10Gi
    logging: {}
    tracing: {}
    template: {}
    rollingUpdate:
      maxUnavailable: 1
      partition: 0
