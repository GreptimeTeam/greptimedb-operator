apiVersion: greptime.io/v1alpha1
kind: GreptimeDBCluster
metadata:
  name: test01
  namespace: default
spec:
  version: latest
  initializer:
    image: greptime/greptimedb-initializer:latest
  httpPort: 4000
  rpcPort: 4001
  mysqlPort: 4002
  postgreSQLPort: 4003
  logging:
    format: text
    level: info
    logsDir: /data/greptimedb/logs
    onlyLogToStdout: false
    persistentWithData: false
  base:
    main:
      image: greptime/greptimedb:latest
      livenessProbe:
        httpGet:
          path: /health
          port: 4000
      resources:
        requests:
          cpu: "500m"
          memory: "256Mi"
        limits:
          cpu: "1"
          memory: "1Gi"
  frontend:
    replicas: 1
    service:
      type: ClusterIP
    template:
      main:
        image: greptime/greptimedb:latest
        args:
          - --metasrv-addrs
          - meta.default:3002
        resources:
          requests:
            cpu: "500m"
            memory: "256Mi"
          limits:
            cpu: "1"
            memory: "1Gi"
        livenessProbe:
          httpGet:
            path: /health
            port: 4000
  meta:
    enableRegionFailover: false
    etcdEndpoints:
      - etcd.etcd-cluster.svc.cluster.local:2379
    httpPort: 4000
    rpcPort: 3002
    replicas: 1
    template:
      main:
        image: greptime/greptimedb:latest
        args:
          - --store-addr
          - etcd.default:2379
        resources:
          requests:
            cpu: "500m"
            memory: "256Mi"
          limits:
            cpu: "1"
            memory: "1Gi"
        livenessProbe:
          httpGet:
            path: /health
            port: 4000
  datanode:
    httpPort: 4000
    rpcPort: 4001
    replicas: 1
    storage:
      dataHome: /data/greptimedb
      fs:
        name: datanode
        mountPath: /data/greptimedb
        storageRetainPolicy: Retain
        storageSize: 10Gi
    template:
      main:
        image: greptime/greptimedb:latest
        resources:
          requests:
            cpu: "500m"
            memory: "256Mi"
          limits:
            cpu: "1"
            memory: "1Gi"
        livenessProbe:
          httpGet:
            path: /health
            port: 4000
